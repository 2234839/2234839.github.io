<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>匿议</title>
	</head>
	<body>
		<p id="w1"></p>
		<p id="w2"></p>
		<div id="zhuti" style="width:400px; margin: 0 auto;"><!--聊天文本显示主体-->
			
		</div>
		<script type="text/javascript">
			function add(string){
				document.getElementById("w1").innerHTML=document.getElementById("w1").innerHTML+string+"<br/>";
			}
			//获取消息数据
			function loadXMLDoc(Name_s,XiaoXi_s)//【名字数组数，消息数组数】//通过模拟post来发送数据
			{
				var xmlhttp;
				if (window.XMLHttpRequest){// code for IE7+, Firefox, Chrome, Opera, Safari
  						xmlhttp=new XMLHttpRequest();
  				}
				else{// code for IE6, IE5
  					xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  				}
				xmlhttp.onreadystatechange=function(){//alert(xmlhttp.responseText); 完整的post数据
  					if (xmlhttp.readyState==4 && xmlhttp.status==200)
  					{
  						a=xmlhttp.responseText;//接收到的返回数据
  						FenLiName();
    				}
  				}
				xmlhttp.open("POST","php/post.php",true);
				xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				xmlhttp.send("names="+Name_s+"&"+"xiaoxis="+XiaoXi_s);
			}
			
			//输出消息
			function ShuChu(s){
				temp=s.substr(0,11);
				temp2=s.substring(11,14);
				if(temp2.substr(0,2)=="00"){
					temp2=temp2.substr(2,3);
				}else if(temp2.substr(0,1)=="0"){
						temp2=temp2.substr(1,3);
						}else{
							temp2=s.substring(9,12);
						}
				temp3=s.substring(14,s.length);
				s=temp+"&nbsp;"+Name[temp2]+temp3;
				document.getElementById("zhuti").innerHTML=document.getElementById("zhuti").innerHTML+"<p>"+s+"</p>"
			}
			function FenLiName(){//分离出名字数组
				
				temp=a.substring(0,a.indexOf("\n\n"));
				
				Name=temp.split("\n");//使用name作为数组名时出现了一个比较奇怪的问题！！！
				FenLiXiaoXi();
			}
			function FenLiXiaoXi(){//分离出消息数组
				add(a);
				temp=a.substring(a.indexOf("\n\n")+2,a.length-1);//数字偏移是为了去除首尾换行符
				var XiaoXi=new Array();
				XiaoXi=temp.split("\n");

				for(i=0;i<XiaoXi.length;i++){
					//add(i+":"+XiaoXi[i]);
					ShuChu(XiaoXi[i]);
				}
			}
			var Name=new Array();
			var a="";
			loadXMLDoc(2,3);
			
			
			//print("");可调用打印
			
			
//			add("//n的位置"+a.indexOf("\n"));
			
		</script>
	</body>
</html>
